# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

OpticWorks Intranet - Internal documentation and resources site for OpticWorks team members. Built with Astro and Starlight, providing centralized access to employee handbooks, IT resources, development guides, and company policies.

## Commands

Development server (runs on `localhost:4321`):
```bash
npm run dev
```

Production build:
```bash
npm run build
```

Preview production build:
```bash
npm run preview
```

Astro CLI commands:
```bash
npm run astro ...
```

## Architecture

### Tech Stack
- **Framework**: Astro 5.6+ with Starlight integration
- **Language**: TypeScript with strict mode
- **Content**: Markdown/MDX files in `src/content/docs/`

### Project Structure
- `src/content/docs/` - All documentation pages (`.md` or `.mdx` files)
- `src/assets/` - Images and media (reference with relative links in Markdown)
- `src/styles/custom.css` - Custom CSS overrides for Starlight theme
- `public/` - Static assets (favicons, etc.)
- `astro.config.mjs` - Astro configuration with Starlight setup
- `src/content.config.ts` - Content collections configuration using Starlight's docsLoader and docsSchema

### Starlight Configuration
The sidebar navigation is manually configured in `astro.config.mjs` with the following sections:
- Getting Started (Welcome, New Employee Onboarding)
- Employee Handbook (Company Culture, Benefits & Perks, Time Off Policy)
- IT Resources (Software & Tools, Security Guidelines, Support Tickets)
- Development (Development Setup, Code Standards, Git Workflow)
- Policies (autogenerated from `policies/` directory)

### Branding
OpticWorks brand color: `#61ee64` (bright green). Color palette and theme variables are defined in `src/styles/custom.css` with both light and dark theme support using CSS custom properties (`--sl-color-accent-*` and `--color-accent-*`).

### Routing
Files in `src/content/docs/` are automatically exposed as routes based on their file name. For example:
- `src/content/docs/index.mdx` → `/`
- `src/content/docs/handbook/culture.md` → `/handbook/culture`

## Deployment

The site is deployed to Google Cloud Storage as a static website.

### Initial Deployment Setup

Bucket: `gs://opticworks-intranet/`
- Configured with website settings (index.html, 404.html)
- Requires public access to be enabled in GCP Console (organization policy prevents CLI access)

### Deploy Updates

Build and deploy to GCS:
```bash
npm run build
gsutil -m rsync -r -c -d dist/ gs://opticworks-intranet/
```

Set cache headers (run after first upload or when assets change):
```bash
# Cache hashed assets for 1 year (immutable)
gsutil -m setmeta -h "Cache-Control:public, max-age=31536000, immutable" "gs://opticworks-intranet/_astro/*"

# Cache HTML files for 1 hour
gsutil -m setmeta -h "Cache-Control:public, max-age=3600" "gs://opticworks-intranet/**/*.html"
```

### Access URL

The site is accessible at:
- **Primary URL**: `https://storage.googleapis.com/opticworks-intranet/index.html`

**Note**: Astro is configured with `base: '/opticworks-intranet'` to ensure assets load correctly from this URL structure.

For HTTPS with a custom domain, configure a Cloud Load Balancer with Cloud CDN pointing to the bucket backend.
